(function(e,t){"function"==typeof define&&define.amd?define([],t(e)):e.Calendar=t(e)})("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";let t=moment(),d=0,a={};const n={container:"#calendar",dates:[],date:moment().date(1),language:"en",previousBtn:{text:"Prev",class:["btn-primary"]},nextBtn:{text:"Next",class:["btn-primary"]},todayBtn:{text:"Today",class:["btn-outline-primary"]}},o=function(e){return a=Object.assign(n,e),t.locale(a.language),a.date=t.date(1),f(),o},l=()=>{let e=moment(a.date).date(1),t=moment(e).date(e.daysInMonth()),d=1;for(1==t.week()&&d++;1==t.week();)t.add(-1,"days");return t.week()-e.week()+d},r=()=>{let e=moment(a.date),t=[];for(var n=0;n<d;n++)for(var o=0;o<7;o++){let d=e.format("D");e.format("d")!=o?t.push(null):(t.includes(d)||t.push(d),d<=e.daysInMonth()&&e.add(1,"days"))}return t},i=(e,t,d)=>{let a=t||[],n=d||[],o=document.createElement(e);return a.forEach((e,t)=>{o.setAttribute(e[0],e[1])}),Array.isArray(n)?n.forEach((e,t)=>{o.classList.add(e)}):"string"==typeof n&&o.classList.add(n),o},c=(e,t)=>{let d=new CustomEvent(e);t&&(d.data=t),document.querySelector(a.container).dispatchEvent(d)},s=e=>{let t=i("div",null,["calendar-header","row"]),d=i("div",null,["col-sm-6","text-start"]),n=i("h3");n.innerHTML=a.date.format("MMMM YYYY"),d.appendChild(n),t.appendChild(d);let o=i("div",null,["col-sm-6","text-end"]);m(o),t.appendChild(o),e.appendChild(t)},m=e=>{let t=i("div",[["role","group"]],"btn-group"),d=i("button",[["type","button"]],["navigation","previous-month","btn","btn-sm"].concat(a.previousBtn.class));d.innerHTML=a.previousBtn.text,t.appendChild(d);let n=i("button",[["type","button"]],["navigation","today","btn","btn-sm"].concat(a.todayBtn.class));n.innerHTML=a.todayBtn.text,t.appendChild(n);let o=i("button",[["type","button"]],["navigation","next-month","btn","btn-sm"].concat(a.nextBtn.class));o.innerHTML=a.nextBtn.text,t.appendChild(o),e.appendChild(t)},p=e=>{let t=moment([2020,2,1]);t.locale(a.language);let d=i("thead"),n=document.createElement("tr"),o=document.createElement("th");o.innerText=t.format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),n.appendChild(o.cloneNode(!0)),d.appendChild(n),e.appendChild(d)},u=e=>{let t=r(),n=document.createElement("tbody"),o=0,l=moment(a.date).subtract(1,"days");for(var s=0;s<d;s++){let e=document.createElement("tr");for(var m=0;m<7;m++){let d=document.createElement("td");if(t[o]){l.add(1,"days");let e=l.format("YYYY-MM-DD"),n=document.createElement("span");n.innerText=t[o],t[o]==moment().format("D")&&l.format("MM")==moment().format("MM")&&d.classList.add("today"),d.dataset.dt=e,d.appendChild(n);let r=a.dates.filter(t=>t.date==e).sort((e,t)=>e.time<t.time?-1:e.time>t.time?1:0);r.forEach((e,t)=>{let a=(e.time?e.time+" - ":"")+e.title,n=i("div",[["title",a]],["event",e.type]),o=i("span"),l="<span>";e.done&&(l+='<b class="done">&check;</b>'),l+=a+"</span>",o.innerHTML=l,n.appendChild(o),n.addEventListener("click",t=>(t.preventDefault(),c("calendar.date.select",{id:e.id,date:e.date,time:e.time}),!1)),d.append(n)})}e.appendChild(d),o++}n.appendChild(e)}e.appendChild(n)},h=e=>{let t=document.createElement("table");t.classList.add("table","table-sm"),p(t),d=l(),u(t),e.appendChild(t);let a=document.querySelector(".calendar .table").offsetWidth;Array.from(document.querySelectorAll(".calendar .table tbody td .event")).forEach((e,t)=>{e.style.width=a/7-10+"px"})},f=()=>{let e=document.querySelector(a.container);e.innerHTML="",e.classList.add("calendar"),s(e),h(e),y()};o.next=(()=>{a.date.add(-1,"month"),f(),c("calendar.month.change")}),o.previous=(()=>{a.date.add(1,"month"),f(),c("calendar.month.change")}),o.today=(()=>{a.date=moment().lang(a.language).date(1),f(),c("calendar.month.change")}),o.refresh=(()=>{f(),c("calendar.refresh")}),o.setDates=(e=>{a.dates=e,f(),c("calendar.update")}),o.remove=(e=>{a.dates=a.dates.filter(t=>t.id!=e),f(),c("calendar.update")}),o.add=(e=>{a.dates.push(e),f(),c("calendar.update")}),o.done=(e=>{a.dates.forEach((t,d)=>{t.id==e&&(t.done=!0)}),f(),c("calendar.update")}),o.undone=(e=>{a.dates.forEach((t,d)=>{t.id==e&&(t.done=!1)}),f(),c("calendar.update")});const y=()=>{let e=document.querySelector(".calendar .navigation.previous-month");e.addEventListener("click",e=>(e.preventDefault(),o.next(),!1));let t=document.querySelector(".calendar .navigation.next-month");t.addEventListener("click",e=>(e.preventDefault(),o.previous(),!1));let d=document.querySelector(".calendar .navigation.today");d.addEventListener("click",e=>(e.preventDefault(),o.today(),!1))};return o});