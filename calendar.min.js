/*!
 * Calendar v1.1 - Javascript Calendar plugin to Agenda Applications
 * Copyright 2021 Silvio Delgado (https://github.com/silviodelgado)
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 * Dependencies: moment.js & Bootstrap 5+
 * https://github.com/silviodelgado/Calendar
*/
(function(e,t){"function"==typeof define&&define.amd?define([],t(e)):e.Calendar=t(e)})("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";let t=moment(),d=0,n={};const a={container:"#calendar",dates:[],date:moment().date(1),language:"en",previousBtn:"Prev",nextBtn:"Next",todayBtn:"Today"},o=function(e){return n=Object.assign(a,e),t.locale(n.language),n.date=t.date(1),f(),o},r=()=>{let e=moment(n.date).date(1),t=moment(e).date(e.daysInMonth()),d=1;for(1==t.week()&&d++;1==t.week();)t.add(-1,"days");return t.week()-e.week()+d},l=()=>{let e=moment(n.date),t=[];for(var a=0;a<d;a++)for(var o=0;o<7;o++){let d=e.format("D");e.format("d")!=o?t.push(null):(t.includes(d)||t.push(d),d<=e.daysInMonth()&&e.add(1,"days"))}return t},i=(e,t,d)=>{let n=t||[],a=d||[],o=document.createElement(e);return n.forEach((e,t)=>{o.setAttribute(e[0],e[1])}),Array.isArray(a)?a.forEach((e,t)=>{o.classList.add(e)}):"string"==typeof a&&o.classList.add(a),o},c=(e,t)=>{let d=new CustomEvent(e);t&&(d.data=t),document.querySelector(n.container).dispatchEvent(d)},m=e=>{let t=i("div",null,["calendar-header","row"]),d=i("div",null,["col-sm-6","text-start"]),a=i("h3");a.innerHTML=n.date.format("MMMM YYYY"),d.appendChild(a),t.appendChild(d);let o=i("div",null,["col-sm-6","text-end"]);s(o),t.appendChild(o),e.appendChild(t)},s=e=>{let t=i("div",[["role","group"]],"btn-group"),d=i("button",[["type","button"]],["navigation","previous-month","btn","btn-sm","btn-primary"]);d.innerHTML=n.previousBtn,t.appendChild(d);let a=i("button",[["type","button"]],["navigation","today","btn","btn-sm","btn-outline-primary"]);a.innerHTML=n.todayBtn,t.appendChild(a);let o=i("button",[["type","button"]],["navigation","next-month","btn","btn-sm","btn-primary"]);o.innerHTML=n.nextBtn,t.appendChild(o),e.appendChild(t)},p=e=>{let t=moment([2020,2,1]);t.locale(n.language);let d=i("thead"),a=document.createElement("tr"),o=document.createElement("th");o.innerText=t.format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),o.innerText=t.add(1,"days").format("dddd"),a.appendChild(o.cloneNode(!0)),d.appendChild(a),e.appendChild(d)},u=e=>{let t=l(),a=document.createElement("tbody"),o=0,r=moment(n.date).subtract(1,"days");for(var m=0;m<d;m++){let e=document.createElement("tr");for(var s=0;s<7;s++){let d=document.createElement("td");if(t[o]){r.add(1,"days");let e=r.format("YYYY-MM-DD"),a=document.createElement("span");a.innerText=t[o],t[o]==moment().format("D")&&r.format("MM")==moment().format("MM")&&d.classList.add("today"),d.dataset.dt=e,d.appendChild(a);let l=n.dates.filter(t=>t.date==e).sort((e,t)=>e.time<t.time?-1:e.time>t.time?1:0);l.forEach((e,t)=>{let n=e.time+" - "+e.title,a=i("div",[["title",n]],["event",e.type]),o=i("span"),r="<span>";e.done&&(r+='<b class="done">&check;</b>'),r+=n+"</span>",o.innerHTML=r,a.appendChild(o),a.addEventListener("click",t=>(t.preventDefault(),c("calendar.date.select",{id:e.id,date:e.date,time:e.time}),!1)),d.append(a)})}e.appendChild(d),o++}a.appendChild(e)}e.appendChild(a)},h=e=>{let t=document.createElement("table");t.classList.add("table","table-sm"),p(t),d=r(),u(t),e.appendChild(t);let n=document.querySelector(".calendar .table").offsetWidth;Array.from(document.querySelectorAll(".calendar .table tbody td .event")).forEach((e,t)=>{e.style.width=n/7-10+"px"})},f=()=>{let e=document.querySelector(n.container);e.innerHTML="",e.classList.add("calendar"),m(e),h(e),y()};o.next=(()=>{n.date.add(-1,"month"),f(),c("calendar.month.change")}),o.previous=(()=>{n.date.add(1,"month"),f(),c("calendar.month.change")}),o.today=(()=>{n.date=moment().lang(n.language).date(1),f(),c("calendar.month.change")}),o.refresh=(()=>{f(),c("calendar.refresh")}),o.setDates=(e=>{n.dates=e,f(),c("calendar.update")}),o.remove=(e=>{n.dates=n.dates.filter(t=>t.id!=e),f(),c("calendar.update")}),o.add=(e=>{n.dates.push(e),f(),c("calendar.update")}),o.done=(e=>{n.dates.forEach((t,d)=>{t.id==e&&(t.done=!0)}),f(),c("calendar.update")}),o.undone=(e=>{n.dates.forEach((t,d)=>{t.id==e&&(t.done=!1)}),f(),c("calendar.update")});const y=()=>{let e=document.querySelector(".calendar .navigation.previous-month");e.addEventListener("click",e=>(e.preventDefault(),o.next(),!1));let t=document.querySelector(".calendar .navigation.next-month");t.addEventListener("click",e=>(e.preventDefault(),o.previous(),!1));let d=document.querySelector(".calendar .navigation.today");d.addEventListener("click",e=>(e.preventDefault(),o.today(),!1))};return o});